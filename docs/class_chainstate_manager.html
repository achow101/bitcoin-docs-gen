<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Bitcoin Core: ChainstateManager Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="bitcoin_logo_doxygen.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Bitcoin Core<span id="projectnumber">&#160;22.99.0</span>
   </div>
   <div id="projectbrief">P2P Digital Currency</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="class_chainstate_manager-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">ChainstateManager Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Provides an interface for creating and interacting with one or two chainstates: an IBD chainstate generated by downloading blocks, and an optional snapshot chainstate loaded from a UTXO snapshot.  
 <a href="class_chainstate_manager.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="validation_8h_source.html">validation.h</a>&gt;</code></p>
<div class="dynheader">
Collaboration diagram for ChainstateManager:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_chainstate_manager__coll__graph.svg" width="1756" height="624"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a1e8683b47d65bc84256d3dae399202c9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_block_manager.html">BlockManager</a> m_blockman&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_chainstate_manager.html#a1e8683b47d65bc84256d3dae399202c9">GUARDED_BY</a> (::<a class="el" href="validationinterface_8h.html#ab88a4b9173207cf250ece7820db1f36d">cs_main</a>)</td></tr>
<tr class="memdesc:a1e8683b47d65bc84256d3dae399202c9"><td class="mdescLeft">&#160;</td><td class="mdescRight">A single <a class="el" href="class_block_manager.html" title="Maintains a tree of blocks (stored in m_block_index) which is consulted to determine where the most-w...">BlockManager</a> instance is shared across each constructed chainstate to avoid duplicating block metadata.  <a href="class_chainstate_manager.html#a1e8683b47d65bc84256d3dae399202c9">More...</a><br /></td></tr>
<tr class="separator:a1e8683b47d65bc84256d3dae399202c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acb3d4f764903a904b2a62212ccfb503e"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_chainstate_manager.html#acb3d4f764903a904b2a62212ccfb503e">ActivateSnapshot</a> (<a class="el" href="class_c_auto_file.html">CAutoFile</a> &amp;coins_file, const <a class="el" href="class_snapshot_metadata.html">SnapshotMetadata</a> &amp;metadata, bool in_memory)</td></tr>
<tr class="memdesc:acb3d4f764903a904b2a62212ccfb503e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Construct and activate a Chainstate on the basis of UTXO snapshot data.  <a href="class_chainstate_manager.html#acb3d4f764903a904b2a62212ccfb503e">More...</a><br /></td></tr>
<tr class="separator:acb3d4f764903a904b2a62212ccfb503e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f73b0dd6a4a5474e32ad8936cb1f904"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_c_chain_state.html">CChainState</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_chainstate_manager.html#a5f73b0dd6a4a5474e32ad8936cb1f904">ActiveChainstate</a> () const</td></tr>
<tr class="memdesc:a5f73b0dd6a4a5474e32ad8936cb1f904"><td class="mdescLeft">&#160;</td><td class="mdescRight">The most-work chain.  <a href="class_chainstate_manager.html#a5f73b0dd6a4a5474e32ad8936cb1f904">More...</a><br /></td></tr>
<tr class="separator:a5f73b0dd6a4a5474e32ad8936cb1f904"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc2b67fdd756fb5ce35e01c76a2e7e07"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_c_chain.html">CChain</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_chainstate_manager.html#acc2b67fdd756fb5ce35e01c76a2e7e07">ActiveChain</a> () const</td></tr>
<tr class="separator:acc2b67fdd756fb5ce35e01c76a2e7e07"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a15652acdb54860c62d274345c542b022"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_chainstate_manager.html#a15652acdb54860c62d274345c542b022">ActiveHeight</a> () const</td></tr>
<tr class="separator:a15652acdb54860c62d274345c542b022"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad70e605cc4d4239c6f2df861772e681f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_c_block_index.html">CBlockIndex</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_chainstate_manager.html#ad70e605cc4d4239c6f2df861772e681f">ActiveTip</a> () const</td></tr>
<tr class="separator:ad70e605cc4d4239c6f2df861772e681f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9200b88df1cd3ce4c4b4725139e30515"><td class="memItemLeft" align="right" valign="top"><a class="el" href="validation_8h.html#a6b962fe256607627c8140021ae7a23e1">BlockMap</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_chainstate_manager.html#a9200b88df1cd3ce4c4b4725139e30515">BlockIndex</a> () <a class="el" href="threadsafety_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(</td></tr>
<tr class="separator:a9200b88df1cd3ce4c4b4725139e30515"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a814fe8bd43f0389cd2945a32d201b1f3"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_chainstate_manager.html#a814fe8bd43f0389cd2945a32d201b1f3">IsSnapshotActive</a> () const</td></tr>
<tr class="separator:a814fe8bd43f0389cd2945a32d201b1f3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab8548525271902a7bc17de46b469ecad"><td class="memItemLeft" align="right" valign="top">std::optional&lt; <a class="el" href="classuint256.html">uint256</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_chainstate_manager.html#ab8548525271902a7bc17de46b469ecad">SnapshotBlockhash</a> () const</td></tr>
<tr class="separator:ab8548525271902a7bc17de46b469ecad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae2e103d8c04ee1bada766fdcee2c3347"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_chainstate_manager.html#ae2e103d8c04ee1bada766fdcee2c3347">IsSnapshotValidated</a> () const</td></tr>
<tr class="memdesc:ae2e103d8c04ee1bada766fdcee2c3347"><td class="mdescLeft">&#160;</td><td class="mdescRight">Is there a snapshot in use and has it been fully validated?  <a href="class_chainstate_manager.html#ae2e103d8c04ee1bada766fdcee2c3347">More...</a><br /></td></tr>
<tr class="separator:ae2e103d8c04ee1bada766fdcee2c3347"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d980d7ab403c2cd1bcd45f50ac71c38"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_chainstate_manager.html#a3d980d7ab403c2cd1bcd45f50ac71c38">ProcessNewBlock</a> (const <a class="el" href="class_c_chain_params.html">CChainParams</a> &amp;chainparams, const std::shared_ptr&lt; const <a class="el" href="class_c_block.html">CBlock</a> &gt; &amp;block, bool force_processing, bool *new_block) <a class="el" href="threadsafety_8h.html#a6bb97382864d0bd2cd4dd5191bb03f6c">LOCKS_EXCLUDED</a>(<a class="el" href="validationinterface_8h.html#ab88a4b9173207cf250ece7820db1f36d">cs_main</a>)</td></tr>
<tr class="memdesc:a3d980d7ab403c2cd1bcd45f50ac71c38"><td class="mdescLeft">&#160;</td><td class="mdescRight">Process an incoming block.  <a href="class_chainstate_manager.html#a3d980d7ab403c2cd1bcd45f50ac71c38">More...</a><br /></td></tr>
<tr class="separator:a3d980d7ab403c2cd1bcd45f50ac71c38"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acb18dbfaafb21e2ecbc1969975a4f6ee"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_chainstate_manager.html#acb18dbfaafb21e2ecbc1969975a4f6ee">ProcessNewBlockHeaders</a> (const std::vector&lt; <a class="el" href="class_c_block_header.html">CBlockHeader</a> &gt; &amp;block, <a class="el" href="class_block_validation_state.html">BlockValidationState</a> &amp;state, const <a class="el" href="class_c_chain_params.html">CChainParams</a> &amp;chainparams, const <a class="el" href="class_c_block_index.html">CBlockIndex</a> **ppindex=nullptr) <a class="el" href="threadsafety_8h.html#a6bb97382864d0bd2cd4dd5191bb03f6c">LOCKS_EXCLUDED</a>(<a class="el" href="validationinterface_8h.html#ab88a4b9173207cf250ece7820db1f36d">cs_main</a>)</td></tr>
<tr class="memdesc:acb18dbfaafb21e2ecbc1969975a4f6ee"><td class="mdescLeft">&#160;</td><td class="mdescRight">Process incoming block headers.  <a href="class_chainstate_manager.html#acb18dbfaafb21e2ecbc1969975a4f6ee">More...</a><br /></td></tr>
<tr class="separator:acb18dbfaafb21e2ecbc1969975a4f6ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aae4be51a2d7be9d976f1d1532617a658"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_chainstate_manager.html#aae4be51a2d7be9d976f1d1532617a658">LoadBlockIndex</a> () <a class="el" href="threadsafety_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(<a class="el" href="validationinterface_8h.html#ab88a4b9173207cf250ece7820db1f36d">cs_main</a>)</td></tr>
<tr class="memdesc:aae4be51a2d7be9d976f1d1532617a658"><td class="mdescLeft">&#160;</td><td class="mdescRight">Load the block tree and coins database from disk, initializing state if we're running with -reindex.  <a href="class_chainstate_manager.html#aae4be51a2d7be9d976f1d1532617a658">More...</a><br /></td></tr>
<tr class="separator:aae4be51a2d7be9d976f1d1532617a658"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0b6ebbb16992333a7cbdb94e722af760"><td class="memItemLeft" align="right" valign="top">void Unload() <a class="el" href="threadsafety_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_chainstate_manager.html#a0b6ebbb16992333a7cbdb94e722af760">Reset</a> ()</td></tr>
<tr class="memdesc:a0b6ebbb16992333a7cbdb94e722af760"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unload block index and chain data before shutdown.  <a href="class_chainstate_manager.html#a0b6ebbb16992333a7cbdb94e722af760">More...</a><br /></td></tr>
<tr class="separator:a0b6ebbb16992333a7cbdb94e722af760"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2df86efb12337db8f2499735fd3971cb"><td class="memItemLeft" align="right" valign="top">void MaybeRebalanceCaches() <a class="el" href="threadsafety_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_chainstate_manager.html#a2df86efb12337db8f2499735fd3971cb">~ChainstateManager</a> ()</td></tr>
<tr class="memdesc:a2df86efb12337db8f2499735fd3971cb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check to see if caches are out of balance and if so, call ResizeCoinsCaches() as needed.  <a href="class_chainstate_manager.html#a2df86efb12337db8f2499735fd3971cb">More...</a><br /></td></tr>
<tr class="separator:a2df86efb12337db8f2499735fd3971cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-attribs" name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:ac808481d63cf39cc919d9549411c6f11"><td class="memItemLeft" align="right" valign="top">std::thread&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_chainstate_manager.html#ac808481d63cf39cc919d9549411c6f11">m_load_block</a></td></tr>
<tr class="separator:ac808481d63cf39cc919d9549411c6f11"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a308e4e2c6168afec169598facbd823d9"><td class="memItemLeft" align="right" valign="top">int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_chainstate_manager.html#a308e4e2c6168afec169598facbd823d9">m_total_coinstip_cache</a> {0}</td></tr>
<tr class="memdesc:a308e4e2c6168afec169598facbd823d9"><td class="mdescLeft">&#160;</td><td class="mdescRight">The total number of bytes available for us to use across all in-memory coins caches.  <a href="class_chainstate_manager.html#a308e4e2c6168afec169598facbd823d9">More...</a><br /></td></tr>
<tr class="separator:a308e4e2c6168afec169598facbd823d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d8926c9945152d9a693b7bca30e99ff"><td class="memItemLeft" align="right" valign="top">int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_chainstate_manager.html#a3d8926c9945152d9a693b7bca30e99ff">m_total_coinsdb_cache</a> {0}</td></tr>
<tr class="memdesc:a3d8926c9945152d9a693b7bca30e99ff"><td class="mdescLeft">&#160;</td><td class="mdescRight">The total number of bytes available for us to use across all leveldb coins databases.  <a href="class_chainstate_manager.html#a3d8926c9945152d9a693b7bca30e99ff">More...</a><br /></td></tr>
<tr class="separator:a3d8926c9945152d9a693b7bca30e99ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a463d9a63b38cdc1a46ac5986c18cc492"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_c_chain_state.html">CChainState</a> &amp;InitializeChainstate(<a class="el" href="class_c_tx_mem_pool.html">CTxMemPool</a> *mempool, const std::optional&lt; <a class="el" href="classuint256.html">uint256</a> &gt; &amp;snapshot_blockhash=std::nullopt) <a class="el" href="attributes_8h.html#a37bc3dacb49779a0d18439d4383e5fd9">LIFETIMEBOUND</a> <a class="el" href="threadsafety_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(std::vector&lt; <a class="el" href="class_c_chain_state.html">CChainState</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_chainstate_manager.html#a463d9a63b38cdc1a46ac5986c18cc492">GetAll</a> )()</td></tr>
<tr class="memdesc:a463d9a63b38cdc1a46ac5986c18cc492"><td class="mdescLeft">&#160;</td><td class="mdescRight">Instantiate a new chainstate and assign it based upon whether it is from a snapshot.  <a href="class_chainstate_manager.html#a463d9a63b38cdc1a46ac5986c18cc492">More...</a><br /></td></tr>
<tr class="separator:a463d9a63b38cdc1a46ac5986c18cc492"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-methods" name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a595668be0e3205467f5fa7a576d5697a"><td class="memItemLeft" align="right" valign="top">std::unique_ptr&lt; <a class="el" href="class_c_chain_state.html">CChainState</a> &gt; m_ibd_chainstate&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_chainstate_manager.html#a595668be0e3205467f5fa7a576d5697a">GUARDED_BY</a> (::<a class="el" href="validationinterface_8h.html#ab88a4b9173207cf250ece7820db1f36d">cs_main</a>)</td></tr>
<tr class="memdesc:a595668be0e3205467f5fa7a576d5697a"><td class="mdescLeft">&#160;</td><td class="mdescRight">The chainstate used under normal operation (i.e.  <a href="class_chainstate_manager.html#a595668be0e3205467f5fa7a576d5697a">More...</a><br /></td></tr>
<tr class="separator:a595668be0e3205467f5fa7a576d5697a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afa4d1926597bf1226972057e9473076e"><td class="memItemLeft" align="right" valign="top">std::unique_ptr&lt; <a class="el" href="class_c_chain_state.html">CChainState</a> &gt; m_snapshot_chainstate&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_chainstate_manager.html#afa4d1926597bf1226972057e9473076e">GUARDED_BY</a> (::<a class="el" href="validationinterface_8h.html#ab88a4b9173207cf250ece7820db1f36d">cs_main</a>)</td></tr>
<tr class="memdesc:afa4d1926597bf1226972057e9473076e"><td class="mdescLeft">&#160;</td><td class="mdescRight">A chainstate initialized on the basis of a UTXO snapshot.  <a href="class_chainstate_manager.html#afa4d1926597bf1226972057e9473076e">More...</a><br /></td></tr>
<tr class="separator:afa4d1926597bf1226972057e9473076e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a99437374beacb6ed66590cdfeede1a91"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_c_chain_state.html">CChainState</a> *m_active_chainstate&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_chainstate_manager.html#a99437374beacb6ed66590cdfeede1a91">GUARDED_BY</a> (::<a class="el" href="validationinterface_8h.html#ab88a4b9173207cf250ece7820db1f36d">cs_main</a>)</td></tr>
<tr class="memdesc:a99437374beacb6ed66590cdfeede1a91"><td class="mdescLeft">&#160;</td><td class="mdescRight">Points to either the ibd or snapshot chainstate; indicates our most-work chain.  <a href="class_chainstate_manager.html#a99437374beacb6ed66590cdfeede1a91">More...</a><br /></td></tr>
<tr class="separator:a99437374beacb6ed66590cdfeede1a91"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a734ccf89df9db793d6d9567a51a56419"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_chainstate_manager.html#a734ccf89df9db793d6d9567a51a56419">PopulateAndValidateSnapshot</a> (<a class="el" href="class_c_chain_state.html">CChainState</a> &amp;snapshot_chainstate, <a class="el" href="class_c_auto_file.html">CAutoFile</a> &amp;coins_file, const <a class="el" href="class_snapshot_metadata.html">SnapshotMetadata</a> &amp;metadata)</td></tr>
<tr class="memdesc:a734ccf89df9db793d6d9567a51a56419"><td class="mdescLeft">&#160;</td><td class="mdescRight">Internal helper for <a class="el" href="class_chainstate_manager.html#acb3d4f764903a904b2a62212ccfb503e" title="Construct and activate a Chainstate on the basis of UTXO snapshot data.">ActivateSnapshot()</a>.  <a href="class_chainstate_manager.html#a734ccf89df9db793d6d9567a51a56419">More...</a><br /></td></tr>
<tr class="separator:a734ccf89df9db793d6d9567a51a56419"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-attribs" name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a840b6cff2ceddf4c122f6173f16ad5a5"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_chainstate_manager.html#a840b6cff2ceddf4c122f6173f16ad5a5">m_snapshot_validated</a> {false}</td></tr>
<tr class="memdesc:a840b6cff2ceddf4c122f6173f16ad5a5"><td class="mdescLeft">&#160;</td><td class="mdescRight">If true, the assumed-valid chainstate has been fully validated by the background validation chainstate.  <a href="class_chainstate_manager.html#a840b6cff2ceddf4c122f6173f16ad5a5">More...</a><br /></td></tr>
<tr class="separator:a840b6cff2ceddf4c122f6173f16ad5a5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >Provides an interface for creating and interacting with one or two chainstates: an IBD chainstate generated by downloading blocks, and an optional snapshot chainstate loaded from a UTXO snapshot. </p>
<p >Managed chainstates can be maintained at different heights simultaneously.</p>
<p >This class provides abstractions that allow the retrieval of the current most-work chainstate ("Active") as well as chainstates which may be in background use to validate UTXO snapshots.</p>
<p >Definitions:</p>
<p ><em>IBD chainstate</em>: a chainstate whose current state has been "fully" validated by the initial block download process.</p>
<p ><em>Snapshot chainstate</em>: a chainstate populated by loading in an assumeutxo UTXO snapshot.</p>
<p ><em>Active chainstate</em>: the chainstate containing the current most-work chain. Consulted by most parts of the system (net_processing, wallet) as a reflection of the current chain and UTXO set. This may either be an IBD chainstate or a snapshot chainstate.</p>
<p ><em>Background IBD chainstate</em>: an IBD chainstate for which the IBD process is happening in the background while use of the active (snapshot) chainstate allows the rest of the system to function. </p>

<p class="definition">Definition at line <a class="el" href="validation_8h_source.html#l00846">846</a> of file <a class="el" href="validation_8h_source.html">validation.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a2df86efb12337db8f2499735fd3971cb" name="a2df86efb12337db8f2499735fd3971cb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2df86efb12337db8f2499735fd3971cb">&#9670;&nbsp;</a></span>~ChainstateManager()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void MaybeRebalanceCaches() <a class="el" href="threadsafety_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>( ChainstateManager::~ChainstateManager </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check to see if caches are out of balance and if so, call ResizeCoinsCaches() as needed. </p>

<p class="definition">Definition at line <a class="el" href="validation_8h_source.html#l01010">1010</a> of file <a class="el" href="validation_8h_source.html">validation.h</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_chainstate_manager_a2df86efb12337db8f2499735fd3971cb_cgraph.svg" width="1060" height="114"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="acb3d4f764903a904b2a62212ccfb503e" name="acb3d4f764903a904b2a62212ccfb503e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acb3d4f764903a904b2a62212ccfb503e">&#9670;&nbsp;</a></span>ActivateSnapshot()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ChainstateManager::ActivateSnapshot </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_c_auto_file.html">CAutoFile</a> &amp;&#160;</td>
          <td class="paramname"><em>coins_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_snapshot_metadata.html">SnapshotMetadata</a> &amp;&#160;</td>
          <td class="paramname"><em>metadata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>in_memory</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Construct and activate a Chainstate on the basis of UTXO snapshot data. </p>
<p >Steps:</p>
<ul>
<li>Initialize an unused <a class="el" href="class_c_chain_state.html" title="CChainState stores and provides an API to update our local knowledge of the current best chain.">CChainState</a>.</li>
<li>Load its <code><a class="el" href="class_coins_views.html" title="A convenience class for constructing the CCoinsView* hierarchy used to facilitate access to the UTXO ...">CoinsViews</a></code> contents from <code>coins_file</code>.</li>
<li>Verify that the hash of the resulting coinsdb matches the expected hash per assumeutxo chain parameters.</li>
<li>Wait for our headers chain to include the base block of the snapshot.</li>
<li>"Fast forward" the tip of the new chainstate to the base of the snapshot, faking nTx* block index data along the way.</li>
<li>Move the new chainstate to <code>m_snapshot_chainstate</code> and make it our ChainstateActive(). </li>
</ul>

<p class="definition">Definition at line <a class="el" href="validation_8cpp_source.html#l04674">4674</a> of file <a class="el" href="validation_8cpp_source.html">validation.cpp</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_chainstate_manager_acb3d4f764903a904b2a62212ccfb503e_cgraph.svg" width="1446" height="1519"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="acc2b67fdd756fb5ce35e01c76a2e7e07" name="acc2b67fdd756fb5ce35e01c76a2e7e07"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acc2b67fdd756fb5ce35e01c76a2e7e07">&#9670;&nbsp;</a></span>ActiveChain()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_c_chain.html">CChain</a> &amp; ChainstateManager::ActiveChain </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="validation_8h_source.html#l00945">945</a> of file <a class="el" href="validation_8h_source.html">validation.h</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_chainstate_manager_acc2b67fdd756fb5ce35e01c76a2e7e07_icgraph.svg" width="2030" height="1060"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a5f73b0dd6a4a5474e32ad8936cb1f904" name="a5f73b0dd6a4a5474e32ad8936cb1f904"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5f73b0dd6a4a5474e32ad8936cb1f904">&#9670;&nbsp;</a></span>ActiveChainstate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_c_chain_state.html">CChainState</a> &amp; ChainstateManager::ActiveChainstate </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The most-work chain. </p>

<p class="definition">Definition at line <a class="el" href="validation_8cpp_source.html#l04953">4953</a> of file <a class="el" href="validation_8cpp_source.html">validation.cpp</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_chainstate_manager_a5f73b0dd6a4a5474e32ad8936cb1f904_cgraph.svg" width="279" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_chainstate_manager_a5f73b0dd6a4a5474e32ad8936cb1f904_icgraph.svg" width="2687" height="1502"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a15652acdb54860c62d274345c542b022" name="a15652acdb54860c62d274345c542b022"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a15652acdb54860c62d274345c542b022">&#9670;&nbsp;</a></span>ActiveHeight()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int ChainstateManager::ActiveHeight </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="validation_8h_source.html#l00946">946</a> of file <a class="el" href="validation_8h_source.html">validation.h</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_chainstate_manager_a15652acdb54860c62d274345c542b022_icgraph.svg" width="407" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ad70e605cc4d4239c6f2df861772e681f" name="ad70e605cc4d4239c6f2df861772e681f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad70e605cc4d4239c6f2df861772e681f">&#9670;&nbsp;</a></span>ActiveTip()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_c_block_index.html">CBlockIndex</a> * ChainstateManager::ActiveTip </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="validation_8h_source.html#l00947">947</a> of file <a class="el" href="validation_8h_source.html">validation.h</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_chainstate_manager_ad70e605cc4d4239c6f2df861772e681f_icgraph.svg" width="427" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a9200b88df1cd3ce4c4b4725139e30515" name="a9200b88df1cd3ce4c4b4725139e30515"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9200b88df1cd3ce4c4b4725139e30515">&#9670;&nbsp;</a></span>BlockIndex()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="validation_8h.html#a6b962fe256607627c8140021ae7a23e1">BlockMap</a> &amp; ChainstateManager::BlockIndex </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="validation_8h_source.html#l00949">949</a> of file <a class="el" href="validation_8h_source.html">validation.h</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_chainstate_manager_a9200b88df1cd3ce4c4b4725139e30515_icgraph.svg" width="1347" height="190"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a595668be0e3205467f5fa7a576d5697a" name="a595668be0e3205467f5fa7a576d5697a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a595668be0e3205467f5fa7a576d5697a">&#9670;&nbsp;</a></span>GUARDED_BY() <span class="overload">[1/4]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::unique_ptr&lt; <a class="el" href="class_c_chain_state.html">CChainState</a> &gt; m_ibd_chainstate ChainstateManager::GUARDED_BY </td>
          <td>(</td>
          <td class="paramtype">::<a class="el" href="validationinterface_8h.html#ab88a4b9173207cf250ece7820db1f36d">cs_main</a>&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The chainstate used under normal operation (i.e. </p>
<p >"regular" IBD) or, if a snapshot is in use, for background validation.</p>
<p >Its contents (including on-disk data) will be deleted <em>upon shutdown</em> after background validation of the snapshot has completed. We do not free the chainstate contents immediately after it finishes validation to cautiously avoid a case where some other part of the system is still using this pointer (e.g. net_processing).</p>
<p >Once this pointer is set to a corresponding chainstate, it will not be reset until init.cpp:<a class="el" href="init_8cpp.html#a441fc2acf4e8b6940f4f936fe60464bf">Shutdown()</a>.</p>
<p >This is especially important when, e.g., calling ActivateBestChain() on all chainstates because we are not able to hold <a class="el" href="validationinterface_8h.html#ab88a4b9173207cf250ece7820db1f36d" title="Mutex to guard access to validation specific variables, such as reading or changing the chainstate.">cs_main</a> going into that call. </p>

</div>
</div>
<a id="afa4d1926597bf1226972057e9473076e" name="afa4d1926597bf1226972057e9473076e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afa4d1926597bf1226972057e9473076e">&#9670;&nbsp;</a></span>GUARDED_BY() <span class="overload">[2/4]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::unique_ptr&lt; <a class="el" href="class_c_chain_state.html">CChainState</a> &gt; m_snapshot_chainstate ChainstateManager::GUARDED_BY </td>
          <td>(</td>
          <td class="paramtype">::<a class="el" href="validationinterface_8h.html#ab88a4b9173207cf250ece7820db1f36d">cs_main</a>&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>A chainstate initialized on the basis of a UTXO snapshot. </p>
<p >If this is non-null, it is always our active chainstate.</p>
<p >Once this pointer is set to a corresponding chainstate, it will not be reset until init.cpp:<a class="el" href="init_8cpp.html#a441fc2acf4e8b6940f4f936fe60464bf">Shutdown()</a>.</p>
<p >This is especially important when, e.g., calling ActivateBestChain() on all chainstates because we are not able to hold <a class="el" href="validationinterface_8h.html#ab88a4b9173207cf250ece7820db1f36d" title="Mutex to guard access to validation specific variables, such as reading or changing the chainstate.">cs_main</a> going into that call. </p>

</div>
</div>
<a id="a99437374beacb6ed66590cdfeede1a91" name="a99437374beacb6ed66590cdfeede1a91"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a99437374beacb6ed66590cdfeede1a91">&#9670;&nbsp;</a></span>GUARDED_BY() <span class="overload">[3/4]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_c_chain_state.html">CChainState</a> *m_active_chainstate ChainstateManager::GUARDED_BY </td>
          <td>(</td>
          <td class="paramtype">::<a class="el" href="validationinterface_8h.html#ab88a4b9173207cf250ece7820db1f36d">cs_main</a>&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Points to either the ibd or snapshot chainstate; indicates our most-work chain. </p>
<p >Once this pointer is set to a corresponding chainstate, it will not be reset until init.cpp:<a class="el" href="init_8cpp.html#a441fc2acf4e8b6940f4f936fe60464bf">Shutdown()</a>.</p>
<p >This is especially important when, e.g., calling ActivateBestChain() on all chainstates because we are not able to hold <a class="el" href="validationinterface_8h.html#ab88a4b9173207cf250ece7820db1f36d" title="Mutex to guard access to validation specific variables, such as reading or changing the chainstate.">cs_main</a> going into that call. </p>

<p class="definition">Definition at line <a class="el" href="validation_8h_source.html#l00886">886</a> of file <a class="el" href="validation_8h_source.html">validation.h</a>.</p>

</div>
</div>
<a id="a1e8683b47d65bc84256d3dae399202c9" name="a1e8683b47d65bc84256d3dae399202c9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1e8683b47d65bc84256d3dae399202c9">&#9670;&nbsp;</a></span>GUARDED_BY() <span class="overload">[4/4]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_block_manager.html">BlockManager</a> m_blockman ChainstateManager::GUARDED_BY </td>
          <td>(</td>
          <td class="paramtype">::<a class="el" href="validationinterface_8h.html#ab88a4b9173207cf250ece7820db1f36d">cs_main</a>&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>A single <a class="el" href="class_block_manager.html" title="Maintains a tree of blocks (stored in m_block_index) which is consulted to determine where the most-w...">BlockManager</a> instance is shared across each constructed chainstate to avoid duplicating block metadata. </p>

</div>
</div>
<a id="a814fe8bd43f0389cd2945a32d201b1f3" name="a814fe8bd43f0389cd2945a32d201b1f3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a814fe8bd43f0389cd2945a32d201b1f3">&#9670;&nbsp;</a></span>IsSnapshotActive()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ChainstateManager::IsSnapshotActive </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="section return"><dt>Returns</dt><dd>true if a snapshot-based chainstate is in use. Also implies that a background validation chainstate is also in use. </dd></dl>

<p class="definition">Definition at line <a class="el" href="validation_8cpp_source.html#l04960">4960</a> of file <a class="el" href="validation_8cpp_source.html">validation.cpp</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_chainstate_manager_a814fe8bd43f0389cd2945a32d201b1f3_icgraph.svg" width="427" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ae2e103d8c04ee1bada766fdcee2c3347" name="ae2e103d8c04ee1bada766fdcee2c3347"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae2e103d8c04ee1bada766fdcee2c3347">&#9670;&nbsp;</a></span>IsSnapshotValidated()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool ChainstateManager::IsSnapshotValidated </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Is there a snapshot in use and has it been fully validated? </p>

<p class="definition">Definition at line <a class="el" href="validation_8h_source.html#l00961">961</a> of file <a class="el" href="validation_8h_source.html">validation.h</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_chainstate_manager_ae2e103d8c04ee1bada766fdcee2c3347_icgraph.svg" width="407" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="aae4be51a2d7be9d976f1d1532617a658" name="aae4be51a2d7be9d976f1d1532617a658"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aae4be51a2d7be9d976f1d1532617a658">&#9670;&nbsp;</a></span>LoadBlockIndex()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ChainstateManager::LoadBlockIndex </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Load the block tree and coins database from disk, initializing state if we're running with -reindex. </p>

<p class="definition">Definition at line <a class="el" href="validation_8cpp_source.html#l04020">4020</a> of file <a class="el" href="validation_8cpp_source.html">validation.cpp</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_chainstate_manager_aae4be51a2d7be9d976f1d1532617a658_cgraph.svg" width="484" height="104"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_chainstate_manager_aae4be51a2d7be9d976f1d1532617a658_icgraph.svg" width="535" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a734ccf89df9db793d6d9567a51a56419" name="a734ccf89df9db793d6d9567a51a56419"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a734ccf89df9db793d6d9567a51a56419">&#9670;&nbsp;</a></span>PopulateAndValidateSnapshot()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool ChainstateManager::PopulateAndValidateSnapshot </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_c_chain_state.html">CChainState</a> &amp;&#160;</td>
          <td class="paramname"><em>snapshot_chainstate</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_c_auto_file.html">CAutoFile</a> &amp;&#160;</td>
          <td class="paramname"><em>coins_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_snapshot_metadata.html">SnapshotMetadata</a> &amp;&#160;</td>
          <td class="paramname"><em>metadata</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Internal helper for <a class="el" href="class_chainstate_manager.html#acb3d4f764903a904b2a62212ccfb503e" title="Construct and activate a Chainstate on the basis of UTXO snapshot data.">ActivateSnapshot()</a>. </p>

<p class="definition">Definition at line <a class="el" href="validation_8cpp_source.html#l04757">4757</a> of file <a class="el" href="validation_8cpp_source.html">validation.cpp</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_chainstate_manager_a734ccf89df9db793d6d9567a51a56419_cgraph.svg" width="1492" height="1388"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_chainstate_manager_a734ccf89df9db793d6d9567a51a56419_icgraph.svg" width="434" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a3d980d7ab403c2cd1bcd45f50ac71c38" name="a3d980d7ab403c2cd1bcd45f50ac71c38"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3d980d7ab403c2cd1bcd45f50ac71c38">&#9670;&nbsp;</a></span>ProcessNewBlock()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ChainstateManager::ProcessNewBlock </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_c_chain_params.html">CChainParams</a> &amp;&#160;</td>
          <td class="paramname"><em>chainparams</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::shared_ptr&lt; const <a class="el" href="class_c_block.html">CBlock</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>block</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>force_processing</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool *&#160;</td>
          <td class="paramname"><em>new_block</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Process an incoming block. </p>
<p >This only returns after the best known valid block is made active. Note that it does not, however, guarantee that the specific block passed to it has been checked for validity!</p>
<p >If you want to <em>possibly</em> get feedback on whether block is valid, you must install a <a class="el" href="class_c_validation_interface.html" title="Implement this to subscribe to events generated in validation.">CValidationInterface</a> (see <a class="el" href="validationinterface_8h.html">validationinterface.h</a>) - this will have its BlockChecked method called whenever <em>any</em> block completes validation.</p>
<p >Note that we guarantee that either the proof-of-work is valid on block, or (and possibly also) BlockChecked will have been called.</p>
<p >May not be called in a validationinterface callback.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">block</td><td>The block we want to process. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">force_processing</td><td>Process this block even if unrequested; used for non-network block sources. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">new_block</td><td>A boolean which is set to indicate if the block was first received via this call </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>If the block was processed, independently of block validity </dd></dl>

<p class="definition">Definition at line <a class="el" href="validation_8cpp_source.html#l03387">3387</a> of file <a class="el" href="validation_8cpp_source.html">validation.cpp</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_chainstate_manager_a3d980d7ab403c2cd1bcd45f50ac71c38_cgraph.svg" width="1170" height="2463"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_chainstate_manager_a3d980d7ab403c2cd1bcd45f50ac71c38_icgraph.svg" width="1714" height="291"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="acb18dbfaafb21e2ecbc1969975a4f6ee" name="acb18dbfaafb21e2ecbc1969975a4f6ee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acb18dbfaafb21e2ecbc1969975a4f6ee">&#9670;&nbsp;</a></span>ProcessNewBlockHeaders()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ChainstateManager::ProcessNewBlockHeaders </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="class_c_block_header.html">CBlockHeader</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>block</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_block_validation_state.html">BlockValidationState</a> &amp;&#160;</td>
          <td class="paramname"><em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_c_chain_params.html">CChainParams</a> &amp;&#160;</td>
          <td class="paramname"><em>chainparams</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_c_block_index.html">CBlockIndex</a> **&#160;</td>
          <td class="paramname"><em>ppindex</em> = <code>nullptr</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Process incoming block headers. </p>
<p >May not be called in a validationinterface callback.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">block</td><td>The block headers themselves </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">state</td><td>This may be set to an Error state if any error occurred processing them </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">chainparams</td><td>The params for the chain we want to connect to </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">ppindex</td><td>If set, the pointer will be set to point to the last new block index object for the given headers </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="validation_8cpp_source.html#l03277">3277</a> of file <a class="el" href="validation_8cpp_source.html">validation.cpp</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_chainstate_manager_acb18dbfaafb21e2ecbc1969975a4f6ee_cgraph.svg" width="916" height="660"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_chainstate_manager_acb18dbfaafb21e2ecbc1969975a4f6ee_icgraph.svg" width="1363" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a0b6ebbb16992333a7cbdb94e722af760" name="a0b6ebbb16992333a7cbdb94e722af760"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0b6ebbb16992333a7cbdb94e722af760">&#9670;&nbsp;</a></span>Reset()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ChainstateManager::Reset </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Unload block index and chain data before shutdown. </p>
<p >Clear (deconstruct) chainstate data. </p>

<p class="definition">Definition at line <a class="el" href="validation_8cpp_source.html#l04976">4976</a> of file <a class="el" href="validation_8cpp_source.html">validation.cpp</a>.</p>

</div>
</div>
<a id="ab8548525271902a7bc17de46b469ecad" name="ab8548525271902a7bc17de46b469ecad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab8548525271902a7bc17de46b469ecad">&#9670;&nbsp;</a></span>SnapshotBlockhash()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::optional&lt; <a class="el" href="classuint256.html">uint256</a> &gt; ChainstateManager::SnapshotBlockhash </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="validation_8cpp_source.html#l04613">4613</a> of file <a class="el" href="validation_8cpp_source.html">validation.cpp</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_chainstate_manager_ab8548525271902a7bc17de46b469ecad_icgraph.svg" width="427" height="155"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a463d9a63b38cdc1a46ac5986c18cc492" name="a463d9a63b38cdc1a46ac5986c18cc492"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a463d9a63b38cdc1a46ac5986c18cc492">&#9670;&nbsp;</a></span>GetAll</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt; <a class="el" href="class_c_chain_state.html">CChainState</a> * &gt; ChainstateManager::GetAll</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Instantiate a new chainstate and assign it based upon whether it is from a snapshot. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">mempool</td><td>The mempool to pass to the chainstate </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">snapshot_blockhash</td><td>If given, signify that this chainstate is based on a snapshot. Get all chainstates currently being used. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="validation_8h_source.html#l00925">925</a> of file <a class="el" href="validation_8h_source.html">validation.h</a>.</p>

</div>
</div>
<a id="ac808481d63cf39cc919d9549411c6f11" name="ac808481d63cf39cc919d9549411c6f11"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac808481d63cf39cc919d9549411c6f11">&#9670;&nbsp;</a></span>m_load_block</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::thread ChainstateManager::m_load_block</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="validation_8h_source.html#l00899">899</a> of file <a class="el" href="validation_8h_source.html">validation.h</a>.</p>

</div>
</div>
<a id="a840b6cff2ceddf4c122f6173f16ad5a5" name="a840b6cff2ceddf4c122f6173f16ad5a5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a840b6cff2ceddf4c122f6173f16ad5a5">&#9670;&nbsp;</a></span>m_snapshot_validated</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool ChainstateManager::m_snapshot_validated {false}</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>If true, the assumed-valid chainstate has been fully validated by the background validation chainstate. </p>

<p class="definition">Definition at line <a class="el" href="validation_8h_source.html#l00890">890</a> of file <a class="el" href="validation_8h_source.html">validation.h</a>.</p>

</div>
</div>
<a id="a3d8926c9945152d9a693b7bca30e99ff" name="a3d8926c9945152d9a693b7bca30e99ff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3d8926c9945152d9a693b7bca30e99ff">&#9670;&nbsp;</a></span>m_total_coinsdb_cache</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t ChainstateManager::m_total_coinsdb_cache {0}</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The total number of bytes available for us to use across all leveldb coins databases. </p>
<p >This will be split somehow across chainstates. </p>

<p class="definition">Definition at line <a class="el" href="validation_8h_source.html#l00910">910</a> of file <a class="el" href="validation_8h_source.html">validation.h</a>.</p>

</div>
</div>
<a id="a308e4e2c6168afec169598facbd823d9" name="a308e4e2c6168afec169598facbd823d9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a308e4e2c6168afec169598facbd823d9">&#9670;&nbsp;</a></span>m_total_coinstip_cache</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t ChainstateManager::m_total_coinstip_cache {0}</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The total number of bytes available for us to use across all in-memory coins caches. </p>
<p >This will be split somehow across chainstates. </p>

<p class="definition">Definition at line <a class="el" href="validation_8h_source.html#l00906">906</a> of file <a class="el" href="validation_8h_source.html">validation.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>src/<a class="el" href="validation_8h_source.html">validation.h</a></li>
<li>src/<a class="el" href="validation_8cpp_source.html">validation.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Nov 8 2021 14:20:11 for Bitcoin Core by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2
</small></address>
</body>
</html>
