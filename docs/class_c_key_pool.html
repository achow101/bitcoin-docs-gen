<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Bitcoin Core: CKeyPool Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="bitcoin_logo_doxygen.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Bitcoin Core<span id="projectnumber">&#160;22.99.0</span>
   </div>
   <div id="projectbrief">P2P Digital Currency</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="class_c_key_pool-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">CKeyPool Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p>A key from a <a class="el" href="class_c_wallet.html" title="A CWallet maintains a set of transactions and balances, and provides the ability to create new transa...">CWallet</a>'s keypool.  
 <a href="class_c_key_pool.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="scriptpubkeyman_8h_source.html">scriptpubkeyman.h</a>&gt;</code></p>
<div class="dynheader">
Collaboration diagram for CKeyPool:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_c_key_pool__coll__graph.svg" width="128" height="127"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ab1f33489faff7a7e1edbd61a5a18f604"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_key_pool.html#ab1f33489faff7a7e1edbd61a5a18f604">CKeyPool</a> ()</td></tr>
<tr class="separator:ab1f33489faff7a7e1edbd61a5a18f604"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a97379b34e09cb31f1a44243a1d23437d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_key_pool.html#a97379b34e09cb31f1a44243a1d23437d">CKeyPool</a> (const <a class="el" href="class_c_pub_key.html">CPubKey</a> &amp;vchPubKeyIn, bool internalIn)</td></tr>
<tr class="separator:a97379b34e09cb31f1a44243a1d23437d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adaa45d7e0626f0555f6049d2f4120a13"><td class="memTemplParams" colspan="2">template&lt;typename Stream &gt; </td></tr>
<tr class="memitem:adaa45d7e0626f0555f6049d2f4120a13"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="class_c_key_pool.html#adaa45d7e0626f0555f6049d2f4120a13">Serialize</a> (Stream &amp;s) const</td></tr>
<tr class="separator:adaa45d7e0626f0555f6049d2f4120a13"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e154fa1ff44e23d717bffc3150eb0e7"><td class="memTemplParams" colspan="2">template&lt;typename Stream &gt; </td></tr>
<tr class="memitem:a3e154fa1ff44e23d717bffc3150eb0e7"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="class_c_key_pool.html#a3e154fa1ff44e23d717bffc3150eb0e7">Unserialize</a> (Stream &amp;s)</td></tr>
<tr class="separator:a3e154fa1ff44e23d717bffc3150eb0e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-attribs" name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:aa2f8263f0baf732ad5b4e4b59b482209"><td class="memItemLeft" align="right" valign="top">int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_key_pool.html#aa2f8263f0baf732ad5b4e4b59b482209">nTime</a></td></tr>
<tr class="memdesc:aa2f8263f0baf732ad5b4e4b59b482209"><td class="mdescLeft">&#160;</td><td class="mdescRight">The time at which the key was generated. Set in AddKeypoolPubKeyWithDB.  <a href="class_c_key_pool.html#aa2f8263f0baf732ad5b4e4b59b482209">More...</a><br /></td></tr>
<tr class="separator:aa2f8263f0baf732ad5b4e4b59b482209"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a937080a4cec1f2b138ebd200557c82b5"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_c_pub_key.html">CPubKey</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_key_pool.html#a937080a4cec1f2b138ebd200557c82b5">vchPubKey</a></td></tr>
<tr class="memdesc:a937080a4cec1f2b138ebd200557c82b5"><td class="mdescLeft">&#160;</td><td class="mdescRight">The public key.  <a href="class_c_key_pool.html#a937080a4cec1f2b138ebd200557c82b5">More...</a><br /></td></tr>
<tr class="separator:a937080a4cec1f2b138ebd200557c82b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a000d3e23c4b76e6fce4ad59e29d5d45b"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_key_pool.html#a000d3e23c4b76e6fce4ad59e29d5d45b">fInternal</a></td></tr>
<tr class="memdesc:a000d3e23c4b76e6fce4ad59e29d5d45b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Whether this keypool entry is in the internal keypool (for change outputs)  <a href="class_c_key_pool.html#a000d3e23c4b76e6fce4ad59e29d5d45b">More...</a><br /></td></tr>
<tr class="separator:a000d3e23c4b76e6fce4ad59e29d5d45b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab82f2a6e0a12feba2f71d5b591014886"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_key_pool.html#ab82f2a6e0a12feba2f71d5b591014886">m_pre_split</a></td></tr>
<tr class="memdesc:ab82f2a6e0a12feba2f71d5b591014886"><td class="mdescLeft">&#160;</td><td class="mdescRight">Whether this key was generated for a keypool before the wallet was upgraded to HD-split.  <a href="class_c_key_pool.html#ab82f2a6e0a12feba2f71d5b591014886">More...</a><br /></td></tr>
<tr class="separator:ab82f2a6e0a12feba2f71d5b591014886"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >A key from a <a class="el" href="class_c_wallet.html" title="A CWallet maintains a set of transactions and balances, and provides the ability to create new transa...">CWallet</a>'s keypool. </p>
<p >The wallet holds one (for pre HD-split wallets) or several keypools. These are sets of keys that have not yet been used to provide addresses or receive change.</p>
<p >The Bitcoin Core wallet was originally a collection of unrelated private keys with their associated addresses. If a non-HD wallet generated a key/address, gave that address out and then restored a backup from before that key's generation, then any funds sent to that address would be lost definitively.</p>
<p >The keypool was implemented to avoid this scenario (commit: 10384941). The wallet would generate a set of keys (100 by default). When a new public key was required, either to give out as an address or to use in a change output, it would be drawn from the keypool. The keypool would then be topped up to maintain 100 keys. This ensured that as long as the wallet hadn't used more than 100 keys since the previous backup, all funds would be safe, since a restored wallet would be able to scan for all owned addresses.</p>
<p >A keypool also allowed encrypted wallets to give out addresses without having to be decrypted to generate a new private key.</p>
<p >With the introduction of HD wallets (commit: f1902510), the keypool essentially became an address look-ahead pool. Restoring old backups can no longer definitively lose funds as long as the addresses used were from the wallet's HD seed (since all private keys can be rederived from the seed). However, if many addresses were used since the backup, then the wallet may not know how far ahead in the HD chain to look for its addresses. The keypool is used to implement a 'gap limit'. The keypool maintains a set of keys (by default 1000) ahead of the last used key and scans for the addresses of those keys. This avoids the risk of not seeing transactions involving the wallet's addresses, or of re-using the same address. In the unlikely case where none of the addresses in the <code>gap limit</code> are used on-chain, the look-ahead will not be incremented to keep a constant size and addresses beyond this range will not be detected by an old backup. For this reason, it is not recommended to decrease keypool size lower than default value.</p>
<p >The HD-split wallet feature added a second keypool (commit: 02592f4c). There is an external keypool (for addresses to hand out) and an internal keypool (for change addresses).</p>
<p >Keypool keys are stored in the wallet/keystore's keymap. The keypool data is stored as sets of indexes in the wallet (setInternalKeyPool, setExternalKeyPool and set_pre_split_keypool), and a map from the key to the index (m_pool_key_to_index). The <a class="el" href="class_c_key_pool.html" title="A key from a CWallet&#39;s keypool.">CKeyPool</a> object is used to serialize/deserialize the pool data to/from the database. </p>

<p class="definition">Definition at line <a class="el" href="scriptpubkeyman_8h_source.html#l00101">101</a> of file <a class="el" href="scriptpubkeyman_8h_source.html">scriptpubkeyman.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="ab1f33489faff7a7e1edbd61a5a18f604" name="ab1f33489faff7a7e1edbd61a5a18f604"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab1f33489faff7a7e1edbd61a5a18f604">&#9670;&nbsp;</a></span>CKeyPool() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CKeyPool::CKeyPool </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="wallet_2wallet_8cpp_source.html#l02929">2929</a> of file <a class="el" href="wallet_2wallet_8cpp_source.html">wallet.cpp</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_c_key_pool_ab1f33489faff7a7e1edbd61a5a18f604_cgraph.svg" width="436" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a97379b34e09cb31f1a44243a1d23437d" name="a97379b34e09cb31f1a44243a1d23437d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a97379b34e09cb31f1a44243a1d23437d">&#9670;&nbsp;</a></span>CKeyPool() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CKeyPool::CKeyPool </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_c_pub_key.html">CPubKey</a> &amp;&#160;</td>
          <td class="paramname"><em>vchPubKeyIn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>internalIn</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="wallet_2wallet_8cpp_source.html#l02936">2936</a> of file <a class="el" href="wallet_2wallet_8cpp_source.html">wallet.cpp</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_c_key_pool_a97379b34e09cb31f1a44243a1d23437d_cgraph.svg" width="436" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="adaa45d7e0626f0555f6049d2f4120a13" name="adaa45d7e0626f0555f6049d2f4120a13"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adaa45d7e0626f0555f6049d2f4120a13">&#9670;&nbsp;</a></span>Serialize()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Stream &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void CKeyPool::Serialize </td>
          <td>(</td>
          <td class="paramtype">Stream &amp;&#160;</td>
          <td class="paramname"><em>s</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="scriptpubkeyman_8h_source.html#l00117">117</a> of file <a class="el" href="scriptpubkeyman_8h_source.html">scriptpubkeyman.h</a>.</p>

</div>
</div>
<a id="a3e154fa1ff44e23d717bffc3150eb0e7" name="a3e154fa1ff44e23d717bffc3150eb0e7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3e154fa1ff44e23d717bffc3150eb0e7">&#9670;&nbsp;</a></span>Unserialize()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Stream &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void CKeyPool::Unserialize </td>
          <td>(</td>
          <td class="paramtype">Stream &amp;&#160;</td>
          <td class="paramname"><em>s</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="scriptpubkeyman_8h_source.html#l00127">127</a> of file <a class="el" href="scriptpubkeyman_8h_source.html">scriptpubkeyman.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a000d3e23c4b76e6fce4ad59e29d5d45b" name="a000d3e23c4b76e6fce4ad59e29d5d45b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a000d3e23c4b76e6fce4ad59e29d5d45b">&#9670;&nbsp;</a></span>fInternal</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool CKeyPool::fInternal</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Whether this keypool entry is in the internal keypool (for change outputs) </p>

<p class="definition">Definition at line <a class="el" href="scriptpubkeyman_8h_source.html#l00109">109</a> of file <a class="el" href="scriptpubkeyman_8h_source.html">scriptpubkeyman.h</a>.</p>

</div>
</div>
<a id="ab82f2a6e0a12feba2f71d5b591014886" name="ab82f2a6e0a12feba2f71d5b591014886"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab82f2a6e0a12feba2f71d5b591014886">&#9670;&nbsp;</a></span>m_pre_split</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool CKeyPool::m_pre_split</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Whether this key was generated for a keypool before the wallet was upgraded to HD-split. </p>

<p class="definition">Definition at line <a class="el" href="scriptpubkeyman_8h_source.html#l00111">111</a> of file <a class="el" href="scriptpubkeyman_8h_source.html">scriptpubkeyman.h</a>.</p>

</div>
</div>
<a id="aa2f8263f0baf732ad5b4e4b59b482209" name="aa2f8263f0baf732ad5b4e4b59b482209"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa2f8263f0baf732ad5b4e4b59b482209">&#9670;&nbsp;</a></span>nTime</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t CKeyPool::nTime</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The time at which the key was generated. Set in AddKeypoolPubKeyWithDB. </p>

<p class="definition">Definition at line <a class="el" href="scriptpubkeyman_8h_source.html#l00105">105</a> of file <a class="el" href="scriptpubkeyman_8h_source.html">scriptpubkeyman.h</a>.</p>

</div>
</div>
<a id="a937080a4cec1f2b138ebd200557c82b5" name="a937080a4cec1f2b138ebd200557c82b5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a937080a4cec1f2b138ebd200557c82b5">&#9670;&nbsp;</a></span>vchPubKey</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_c_pub_key.html">CPubKey</a> CKeyPool::vchPubKey</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The public key. </p>

<p class="definition">Definition at line <a class="el" href="scriptpubkeyman_8h_source.html#l00107">107</a> of file <a class="el" href="scriptpubkeyman_8h_source.html">scriptpubkeyman.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>src/wallet/<a class="el" href="scriptpubkeyman_8h_source.html">scriptpubkeyman.h</a></li>
<li>src/wallet/<a class="el" href="wallet_2wallet_8cpp_source.html">wallet.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Nov 8 2021 14:20:11 for Bitcoin Core by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2
</small></address>
</body>
</html>
