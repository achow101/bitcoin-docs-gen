<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Bitcoin Core: BlockManager Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="bitcoin_logo_doxygen.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Bitcoin Core<span id="projectnumber">&#160;22.99.0</span>
   </div>
   <div id="projectbrief">P2P Digital Currency</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="class_block_manager-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">BlockManager Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Maintains a tree of blocks (stored in <code>m_block_index</code>) which is consulted to determine where the most-work tip is.  
 <a href="class_block_manager.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="validation_8h_source.html">validation.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a43f18ff5266d6c3640e51b210e21a016"><td class="memItemLeft" align="right" valign="top"><a class="el" href="validation_8h.html#a6b962fe256607627c8140021ae7a23e1">BlockMap</a> m_block_index&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_block_manager.html#a43f18ff5266d6c3640e51b210e21a016">GUARDED_BY</a> (<a class="el" href="validationinterface_8h.html#ab88a4b9173207cf250ece7820db1f36d">cs_main</a>)</td></tr>
<tr class="separator:a43f18ff5266d6c3640e51b210e21a016"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6d42697e2128af1004956fc1255d944a"><td class="memItemLeft" align="right" valign="top">std::unique_ptr&lt; <a class="el" href="class_c_block_tree_d_b.html">CBlockTreeDB</a> &gt; m_block_tree_db&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_block_manager.html#a6d42697e2128af1004956fc1255d944a">GUARDED_BY</a> (::<a class="el" href="validationinterface_8h.html#ab88a4b9173207cf250ece7820db1f36d">cs_main</a>)</td></tr>
<tr class="separator:a6d42697e2128af1004956fc1255d944a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a48ee023e5949eaed5a9ed4f3da085957"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_block_manager.html#a48ee023e5949eaed5a9ed4f3da085957">Unload</a> () <a class="el" href="threadsafety_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(<a class="el" href="validationinterface_8h.html#ab88a4b9173207cf250ece7820db1f36d">cs_main</a>)</td></tr>
<tr class="memdesc:a48ee023e5949eaed5a9ed4f3da085957"><td class="mdescLeft">&#160;</td><td class="mdescRight">Clear all data members.  <a href="class_block_manager.html#a48ee023e5949eaed5a9ed4f3da085957">More...</a><br /></td></tr>
<tr class="separator:a48ee023e5949eaed5a9ed4f3da085957"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0af7433d0d6ba39b377d83eed19c66d1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_c_block_index.html">CBlockIndex</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_block_manager.html#a0af7433d0d6ba39b377d83eed19c66d1">AddToBlockIndex</a> (const <a class="el" href="class_c_block_header.html">CBlockHeader</a> &amp;block) <a class="el" href="threadsafety_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(<a class="el" href="validationinterface_8h.html#ab88a4b9173207cf250ece7820db1f36d">cs_main</a>)</td></tr>
<tr class="separator:a0af7433d0d6ba39b377d83eed19c66d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a00017eed035cc0708fc9355419128fcd"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_c_block_index.html">CBlockIndex</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_block_manager.html#a00017eed035cc0708fc9355419128fcd">InsertBlockIndex</a> (const <a class="el" href="classuint256.html">uint256</a> &amp;hash) <a class="el" href="threadsafety_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(<a class="el" href="validationinterface_8h.html#ab88a4b9173207cf250ece7820db1f36d">cs_main</a>)</td></tr>
<tr class="memdesc:a00017eed035cc0708fc9355419128fcd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a new block index entry for a given block hash.  <a href="class_block_manager.html#a00017eed035cc0708fc9355419128fcd">More...</a><br /></td></tr>
<tr class="separator:a00017eed035cc0708fc9355419128fcd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7ad2ac723d196afef4b4e56bbfcbfe4a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_block_manager.html#a7ad2ac723d196afef4b4e56bbfcbfe4a">PruneOneBlockFile</a> (const int fileNumber) <a class="el" href="threadsafety_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(<a class="el" href="validationinterface_8h.html#ab88a4b9173207cf250ece7820db1f36d">cs_main</a>)</td></tr>
<tr class="memdesc:a7ad2ac723d196afef4b4e56bbfcbfe4a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mark one block file as pruned (modify associated database entries)  <a href="class_block_manager.html#a7ad2ac723d196afef4b4e56bbfcbfe4a">More...</a><br /></td></tr>
<tr class="separator:a7ad2ac723d196afef4b4e56bbfcbfe4a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7a967c54d86a055eb2822525254988e2"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_block_manager.html#a7a967c54d86a055eb2822525254988e2">AcceptBlockHeader</a> (const <a class="el" href="class_c_block_header.html">CBlockHeader</a> &amp;block, <a class="el" href="class_block_validation_state.html">BlockValidationState</a> &amp;state, const <a class="el" href="class_c_chain_params.html">CChainParams</a> &amp;chainparams, <a class="el" href="class_c_block_index.html">CBlockIndex</a> **ppindex) <a class="el" href="threadsafety_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(<a class="el" href="validationinterface_8h.html#ab88a4b9173207cf250ece7820db1f36d">cs_main</a>)</td></tr>
<tr class="memdesc:a7a967c54d86a055eb2822525254988e2"><td class="mdescLeft">&#160;</td><td class="mdescRight">If a block header hasn't already been seen, call CheckBlockHeader on it, ensure that it doesn't descend from an invalid block, and then add it to m_block_index.  <a href="class_block_manager.html#a7a967c54d86a055eb2822525254988e2">More...</a><br /></td></tr>
<tr class="separator:a7a967c54d86a055eb2822525254988e2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ecd3262962674c6ca2c9979d1613ac8"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_c_block_index.html">CBlockIndex</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_block_manager.html#a2ecd3262962674c6ca2c9979d1613ac8">LookupBlockIndex</a> (const <a class="el" href="classuint256.html">uint256</a> &amp;hash) const <a class="el" href="threadsafety_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(<a class="el" href="validationinterface_8h.html#ab88a4b9173207cf250ece7820db1f36d">cs_main</a>)</td></tr>
<tr class="separator:a2ecd3262962674c6ca2c9979d1613ac8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef852351f0fe83e031051021ebb65797"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_c_block_index.html">CBlockIndex</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_block_manager.html#aef852351f0fe83e031051021ebb65797">FindForkInGlobalIndex</a> (const <a class="el" href="class_c_chain.html">CChain</a> &amp;chain, const <a class="el" href="struct_c_block_locator.html">CBlockLocator</a> &amp;locator) <a class="el" href="threadsafety_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(<a class="el" href="validationinterface_8h.html#ab88a4b9173207cf250ece7820db1f36d">cs_main</a>)</td></tr>
<tr class="memdesc:aef852351f0fe83e031051021ebb65797"><td class="mdescLeft">&#160;</td><td class="mdescRight">Find the last common block between the parameter chain and a locator.  <a href="class_block_manager.html#aef852351f0fe83e031051021ebb65797">More...</a><br /></td></tr>
<tr class="separator:aef852351f0fe83e031051021ebb65797"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a04ed8294298a68609c83bdcbcc053e04"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_c_block_index.html">CBlockIndex</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_block_manager.html#a04ed8294298a68609c83bdcbcc053e04">GetLastCheckpoint</a> (const <a class="el" href="struct_c_checkpoint_data.html">CCheckpointData</a> &amp;data) <a class="el" href="threadsafety_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(<a class="el" href="validationinterface_8h.html#ab88a4b9173207cf250ece7820db1f36d">cs_main</a>)</td></tr>
<tr class="memdesc:a04ed8294298a68609c83bdcbcc053e04"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns last CBlockIndex* that is a checkpoint.  <a href="class_block_manager.html#a04ed8294298a68609c83bdcbcc053e04">More...</a><br /></td></tr>
<tr class="separator:a04ed8294298a68609c83bdcbcc053e04"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf68befb4d17fc8213c20d586b347194"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_block_manager.html#acf68befb4d17fc8213c20d586b347194">GetSpendHeight</a> (const <a class="el" href="class_c_coins_view_cache.html">CCoinsViewCache</a> &amp;inputs) <a class="el" href="threadsafety_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(<a class="el" href="validationinterface_8h.html#ab88a4b9173207cf250ece7820db1f36d">cs_main</a>)</td></tr>
<tr class="memdesc:acf68befb4d17fc8213c20d586b347194"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the spend height, which is one more than the inputs.GetBestBlock().  <a href="class_block_manager.html#acf68befb4d17fc8213c20d586b347194">More...</a><br /></td></tr>
<tr class="separator:acf68befb4d17fc8213c20d586b347194"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c31dd479e07890a5885485fe8d1ccbe"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_block_manager.html#a3c31dd479e07890a5885485fe8d1ccbe">~BlockManager</a> ()</td></tr>
<tr class="separator:a3c31dd479e07890a5885485fe8d1ccbe"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-attribs" name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:a225bfa76e7e892fa9b215b724aea6227"><td class="memItemLeft" align="right" valign="top">std::set&lt; <a class="el" href="class_c_block_index.html">CBlockIndex</a> * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_block_manager.html#a225bfa76e7e892fa9b215b724aea6227">m_failed_blocks</a></td></tr>
<tr class="memdesc:a225bfa76e7e892fa9b215b724aea6227"><td class="mdescLeft">&#160;</td><td class="mdescRight">In order to efficiently track invalidity of headers, we keep the set of blocks which we tried to connect and found to be invalid here (ie which were set to BLOCK_FAILED_VALID since the last restart).  <a href="class_block_manager.html#a225bfa76e7e892fa9b215b724aea6227">More...</a><br /></td></tr>
<tr class="separator:a225bfa76e7e892fa9b215b724aea6227"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeefcdf3e848895712b5011410918b65b"><td class="memItemLeft" align="right" valign="top">std::multimap&lt; <a class="el" href="class_c_block_index.html">CBlockIndex</a> *, <a class="el" href="class_c_block_index.html">CBlockIndex</a> * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_block_manager.html#aeefcdf3e848895712b5011410918b65b">m_blocks_unlinked</a></td></tr>
<tr class="memdesc:aeefcdf3e848895712b5011410918b65b"><td class="mdescLeft">&#160;</td><td class="mdescRight">All pairs A-&gt;B, where A (or one of its ancestors) misses transactions, but B has transactions.  <a href="class_block_manager.html#aeefcdf3e848895712b5011410918b65b">More...</a><br /></td></tr>
<tr class="separator:aeefcdf3e848895712b5011410918b65b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a95beb5e97b85dde3946c926f7e30b6ba"><td class="memItemLeft" align="right" valign="top">bool LoadBlockIndexDB(std::set&lt; <a class="el" href="class_c_block_index.html">CBlockIndex</a> *, <a class="el" href="struct_c_block_index_work_comparator.html">CBlockIndexWorkComparator</a> &gt; &amp;setBlockIndexCandidates) <a class="el" href="threadsafety_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(boo&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_block_manager.html#a95beb5e97b85dde3946c926f7e30b6ba">LoadBlockIndex</a> )(const <a class="el" href="struct_consensus_1_1_params.html">Consensus::Params</a> &amp;consensus_params, std::set&lt; <a class="el" href="class_c_block_index.html">CBlockIndex</a> *, <a class="el" href="struct_c_block_index_work_comparator.html">CBlockIndexWorkComparator</a> &gt; &amp;block_index_candidates) <a class="el" href="threadsafety_8h.html#a0e2e86b0f11d9778240b0a0b263047b1">EXCLUSIVE_LOCKS_REQUIRED</a>(<a class="el" href="validationinterface_8h.html#ab88a4b9173207cf250ece7820db1f36d">cs_main</a>)</td></tr>
<tr class="memdesc:a95beb5e97b85dde3946c926f7e30b6ba"><td class="mdescLeft">&#160;</td><td class="mdescRight">Load the blocktree off disk and into memory.  <a href="class_block_manager.html#a95beb5e97b85dde3946c926f7e30b6ba">More...</a><br /></td></tr>
<tr class="separator:a95beb5e97b85dde3946c926f7e30b6ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-methods" name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:aaf0911af2a06e57c1b00b9e14f24a841"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_block_manager.html#aaf0911af2a06e57c1b00b9e14f24a841">FindFilesToPruneManual</a> (std::set&lt; int &gt; &amp;setFilesToPrune, int nManualPruneHeight, int chain_tip_height)</td></tr>
<tr class="separator:aaf0911af2a06e57c1b00b9e14f24a841"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5db78f98413a00a8c020f9d47d3c6c07"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_block_manager.html#a5db78f98413a00a8c020f9d47d3c6c07">FindFilesToPrune</a> (std::set&lt; int &gt; &amp;setFilesToPrune, uint64_t nPruneAfterHeight, int chain_tip_height, int prune_height, bool is_ibd)</td></tr>
<tr class="memdesc:a5db78f98413a00a8c020f9d47d3c6c07"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prune block and undo files (blk???.dat and undo???.dat) so that the disk space used is less than a user-defined target.  <a href="class_block_manager.html#a5db78f98413a00a8c020f9d47d3c6c07">More...</a><br /></td></tr>
<tr class="separator:a5db78f98413a00a8c020f9d47d3c6c07"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-attribs" name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a366ebe2ac006b5962c332a6f87ea6c54"><td class="memItemLeft" align="right" valign="top">friend&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_block_manager.html#a366ebe2ac006b5962c332a6f87ea6c54">CChainState</a></td></tr>
<tr class="separator:a366ebe2ac006b5962c332a6f87ea6c54"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >Maintains a tree of blocks (stored in <code>m_block_index</code>) which is consulted to determine where the most-work tip is. </p>
<p >This data is used mostly in <code><a class="el" href="class_c_chain_state.html" title="CChainState stores and provides an API to update our local knowledge of the current best chain.">CChainState</a></code> - information about, e.g., candidate tips is not maintained here. </p>

<p class="definition">Definition at line <a class="el" href="validation_8h_source.html#l00374">374</a> of file <a class="el" href="validation_8h_source.html">validation.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a3c31dd479e07890a5885485fe8d1ccbe" name="a3c31dd479e07890a5885485fe8d1ccbe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c31dd479e07890a5885485fe8d1ccbe">&#9670;&nbsp;</a></span>~BlockManager()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">BlockManager::~BlockManager </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="validation_8h_source.html#l00480">480</a> of file <a class="el" href="validation_8h_source.html">validation.h</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_block_manager_a3c31dd479e07890a5885485fe8d1ccbe_cgraph.svg" width="455" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a7a967c54d86a055eb2822525254988e2" name="a7a967c54d86a055eb2822525254988e2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7a967c54d86a055eb2822525254988e2">&#9670;&nbsp;</a></span>AcceptBlockHeader()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool BlockManager::AcceptBlockHeader </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_c_block_header.html">CBlockHeader</a> &amp;&#160;</td>
          <td class="paramname"><em>block</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_block_validation_state.html">BlockValidationState</a> &amp;&#160;</td>
          <td class="paramname"><em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_c_chain_params.html">CChainParams</a> &amp;&#160;</td>
          <td class="paramname"><em>chainparams</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_c_block_index.html">CBlockIndex</a> **&#160;</td>
          <td class="paramname"><em>ppindex</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>If a block header hasn't already been seen, call CheckBlockHeader on it, ensure that it doesn't descend from an invalid block, and then add it to m_block_index. </p>

<p class="definition">Definition at line <a class="el" href="validation_8cpp_source.html#l03188">3188</a> of file <a class="el" href="validation_8cpp_source.html">validation.cpp</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_block_manager_a7a967c54d86a055eb2822525254988e2_cgraph.svg" width="1995" height="914"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_block_manager_a7a967c54d86a055eb2822525254988e2_icgraph.svg" width="2240" height="291"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a0af7433d0d6ba39b377d83eed19c66d1" name="a0af7433d0d6ba39b377d83eed19c66d1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0af7433d0d6ba39b377d83eed19c66d1">&#9670;&nbsp;</a></span>AddToBlockIndex()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_c_block_index.html">CBlockIndex</a> * BlockManager::AddToBlockIndex </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_c_block_header.html">CBlockHeader</a> &amp;&#160;</td>
          <td class="paramname"><em>block</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="validation_8cpp_source.html#l02833">2833</a> of file <a class="el" href="validation_8cpp_source.html">validation.cpp</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_block_manager_a0af7433d0d6ba39b377d83eed19c66d1_cgraph.svg" width="1640" height="290"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_block_manager_a0af7433d0d6ba39b377d83eed19c66d1_icgraph.svg" width="2559" height="354"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a5db78f98413a00a8c020f9d47d3c6c07" name="a5db78f98413a00a8c020f9d47d3c6c07"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5db78f98413a00a8c020f9d47d3c6c07">&#9670;&nbsp;</a></span>FindFilesToPrune()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void BlockManager::FindFilesToPrune </td>
          <td>(</td>
          <td class="paramtype">std::set&lt; int &gt; &amp;&#160;</td>
          <td class="paramname"><em>setFilesToPrune</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>nPruneAfterHeight</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>chain_tip_height</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>prune_height</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>is_ibd</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Prune block and undo files (blk???.dat and undo???.dat) so that the disk space used is less than a user-defined target. </p>
<p >The user sets the target (in MB) on the command line or in config file. This will be run on startup and whenever new space is allocated in a block or undo file, staying below the target. Changing back to unpruned requires a reindex (which in this case means the blockchain must be re-downloaded.)</p>
<p >Pruning functions are called from FlushStateToDisk when the global fCheckForPruning flag has been set. Block and undo files are deleted in lock-step (when blk00003.dat is deleted, so is rev00003.dat.) Pruning cannot take place until the longest chain is at least a certain length (100000 on mainnet, 1000 on testnet, 1000 on regtest). Pruning will never delete a block within a defined distance (currently 288) from the active chain's tip. The block index is updated by unsetting HAVE_DATA and HAVE_UNDO for any blocks that were stored in the deleted files. A db flag records the fact that at least some block files have been pruned.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">setFilesToPrune</td><td>The set of file indices that can be unlinked will be returned </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="validation_8cpp_source.html#l03529">3529</a> of file <a class="el" href="validation_8cpp_source.html">validation.cpp</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_block_manager_a5db78f98413a00a8c020f9d47d3c6c07_cgraph.svg" width="670" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_block_manager_a5db78f98413a00a8c020f9d47d3c6c07_icgraph.svg" width="2818" height="788"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="aaf0911af2a06e57c1b00b9e14f24a841" name="aaf0911af2a06e57c1b00b9e14f24a841"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaf0911af2a06e57c1b00b9e14f24a841">&#9670;&nbsp;</a></span>FindFilesToPruneManual()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void BlockManager::FindFilesToPruneManual </td>
          <td>(</td>
          <td class="paramtype">std::set&lt; int &gt; &amp;&#160;</td>
          <td class="paramname"><em>setFilesToPrune</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nManualPruneHeight</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>chain_tip_height</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="validation_8cpp_source.html#l03496">3496</a> of file <a class="el" href="validation_8cpp_source.html">validation.cpp</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_block_manager_aaf0911af2a06e57c1b00b9e14f24a841_cgraph.svg" width="670" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_block_manager_aaf0911af2a06e57c1b00b9e14f24a841_icgraph.svg" width="2818" height="788"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="aef852351f0fe83e031051021ebb65797" name="aef852351f0fe83e031051021ebb65797"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aef852351f0fe83e031051021ebb65797">&#9670;&nbsp;</a></span>FindForkInGlobalIndex()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_c_block_index.html">CBlockIndex</a> * BlockManager::FindForkInGlobalIndex </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_c_chain.html">CChain</a> &amp;&#160;</td>
          <td class="paramname"><em>chain</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_c_block_locator.html">CBlockLocator</a> &amp;&#160;</td>
          <td class="paramname"><em>locator</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Find the last common block between the parameter chain and a locator. </p>

<p class="definition">Definition at line <a class="el" href="validation_8cpp_source.html#l00157">157</a> of file <a class="el" href="validation_8cpp_source.html">validation.cpp</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_block_manager_aef852351f0fe83e031051021ebb65797_cgraph.svg" width="626" height="371"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_block_manager_aef852351f0fe83e031051021ebb65797_icgraph.svg" width="831" height="139"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a04ed8294298a68609c83bdcbcc053e04" name="a04ed8294298a68609c83bdcbcc053e04"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a04ed8294298a68609c83bdcbcc053e04">&#9670;&nbsp;</a></span>GetLastCheckpoint()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_c_block_index.html">CBlockIndex</a> * BlockManager::GetLastCheckpoint </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_c_checkpoint_data.html">CCheckpointData</a> &amp;&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns last CBlockIndex* that is a checkpoint. </p>

<p class="definition">Definition at line <a class="el" href="validation_8cpp_source.html#l03035">3035</a> of file <a class="el" href="validation_8cpp_source.html">validation.cpp</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_block_manager_a04ed8294298a68609c83bdcbcc053e04_cgraph.svg" width="682" height="104"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="acf68befb4d17fc8213c20d586b347194" name="acf68befb4d17fc8213c20d586b347194"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acf68befb4d17fc8213c20d586b347194">&#9670;&nbsp;</a></span>GetSpendHeight()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int BlockManager::GetSpendHeight </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="class_c_coins_view_cache.html">CCoinsViewCache</a> &amp;&#160;</td>
          <td class="paramname"><em>inputs</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the spend height, which is one more than the inputs.GetBestBlock(). </p>
<p >While checking, GetBestBlock() refers to the parent block. (protected by cs_main) This is also true for mempool checks. </p>

<p class="definition">Definition at line <a class="el" href="validation_8cpp_source.html#l01245">1245</a> of file <a class="el" href="validation_8cpp_source.html">validation.cpp</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_block_manager_acf68befb4d17fc8213c20d586b347194_cgraph.svg" width="736" height="159"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a6d42697e2128af1004956fc1255d944a" name="a6d42697e2128af1004956fc1255d944a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6d42697e2128af1004956fc1255d944a">&#9670;&nbsp;</a></span>GUARDED_BY() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::unique_ptr&lt; <a class="el" href="class_c_block_tree_d_b.html">CBlockTreeDB</a> &gt; m_block_tree_db BlockManager::GUARDED_BY </td>
          <td>(</td>
          <td class="paramtype">::<a class="el" href="validationinterface_8h.html#ab88a4b9173207cf250ece7820db1f36d">cs_main</a>&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a43f18ff5266d6c3640e51b210e21a016" name="a43f18ff5266d6c3640e51b210e21a016"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a43f18ff5266d6c3640e51b210e21a016">&#9670;&nbsp;</a></span>GUARDED_BY() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="validation_8h.html#a6b962fe256607627c8140021ae7a23e1">BlockMap</a> m_block_index BlockManager::GUARDED_BY </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="validationinterface_8h.html#ab88a4b9173207cf250ece7820db1f36d">cs_main</a>&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a00017eed035cc0708fc9355419128fcd" name="a00017eed035cc0708fc9355419128fcd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a00017eed035cc0708fc9355419128fcd">&#9670;&nbsp;</a></span>InsertBlockIndex()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_c_block_index.html">CBlockIndex</a> * BlockManager::InsertBlockIndex </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classuint256.html">uint256</a> &amp;&#160;</td>
          <td class="paramname"><em>hash</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create a new block index entry for a given block hash. </p>

<p class="definition">Definition at line <a class="el" href="validation_8cpp_source.html#l03588">3588</a> of file <a class="el" href="validation_8cpp_source.html">validation.cpp</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_block_manager_a00017eed035cc0708fc9355419128fcd_cgraph.svg" width="388" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a2ecd3262962674c6ca2c9979d1613ac8" name="a2ecd3262962674c6ca2c9979d1613ac8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2ecd3262962674c6ca2c9979d1613ac8">&#9670;&nbsp;</a></span>LookupBlockIndex()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_c_block_index.html">CBlockIndex</a> * BlockManager::LookupBlockIndex </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classuint256.html">uint256</a> &amp;&#160;</td>
          <td class="paramname"><em>hash</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="validation_8cpp_source.html#l00150">150</a> of file <a class="el" href="validation_8cpp_source.html">validation.cpp</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_block_manager_a2ecd3262962674c6ca2c9979d1613ac8_cgraph.svg" width="387" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_block_manager_a2ecd3262962674c6ca2c9979d1613ac8_icgraph.svg" width="2124" height="642"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a7ad2ac723d196afef4b4e56bbfcbfe4a" name="a7ad2ac723d196afef4b4e56bbfcbfe4a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7ad2ac723d196afef4b4e56bbfcbfe4a">&#9670;&nbsp;</a></span>PruneOneBlockFile()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void BlockManager::PruneOneBlockFile </td>
          <td>(</td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>fileNumber</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Mark one block file as pruned (modify associated database entries) </p>
<p >BLOCK PRUNING CODE. </p>

<p class="definition">Definition at line <a class="el" href="validation_8cpp_source.html#l03462">3462</a> of file <a class="el" href="validation_8cpp_source.html">validation.cpp</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_block_manager_a7ad2ac723d196afef4b4e56bbfcbfe4a_cgraph.svg" width="427" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_block_manager_a7ad2ac723d196afef4b4e56bbfcbfe4a_icgraph.svg" width="3111" height="788"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a48ee023e5949eaed5a9ed4f3da085957" name="a48ee023e5949eaed5a9ed4f3da085957"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a48ee023e5949eaed5a9ed4f3da085957">&#9670;&nbsp;</a></span>Unload()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void BlockManager::Unload </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Clear all data members. </p>

<p class="definition">Definition at line <a class="el" href="validation_8cpp_source.html#l03665">3665</a> of file <a class="el" href="validation_8cpp_source.html">validation.cpp</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="class_block_manager_a48ee023e5949eaed5a9ed4f3da085957_icgraph.svg" width="455" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a366ebe2ac006b5962c332a6f87ea6c54" name="a366ebe2ac006b5962c332a6f87ea6c54"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a366ebe2ac006b5962c332a6f87ea6c54">&#9670;&nbsp;</a></span>CChainState</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">friend BlockManager::CChainState</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="validation_8h_source.html#l00376">376</a> of file <a class="el" href="validation_8h_source.html">validation.h</a>.</p>

</div>
</div>
<a id="a95beb5e97b85dde3946c926f7e30b6ba" name="a95beb5e97b85dde3946c926f7e30b6ba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a95beb5e97b85dde3946c926f7e30b6ba">&#9670;&nbsp;</a></span>LoadBlockIndex</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool BlockManager::LoadBlockIndex</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Load the blocktree off disk and into memory. </p>
<p >Populate certain metadata per index entry (nStatus, nChainWork, nTimeMax, etc.) as well as peripheral collections like setDirtyBlockIndex.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">block_index_candidates</td><td>Fill this set with any valid blocks for which we've downloaded all transactions. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="validation_8h_source.html#l00440">440</a> of file <a class="el" href="validation_8h_source.html">validation.h</a>.</p>

</div>
</div>
<a id="aeefcdf3e848895712b5011410918b65b" name="aeefcdf3e848895712b5011410918b65b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeefcdf3e848895712b5011410918b65b">&#9670;&nbsp;</a></span>m_blocks_unlinked</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::multimap&lt;<a class="el" href="class_c_block_index.html">CBlockIndex</a>*, <a class="el" href="class_c_block_index.html">CBlockIndex</a>*&gt; BlockManager::m_blocks_unlinked</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>All pairs A-&gt;B, where A (or one of its ancestors) misses transactions, but B has transactions. </p>
<p >Pruned nodes may have entries where B is missing data. </p>

<p class="definition">Definition at line <a class="el" href="validation_8h_source.html#l00426">426</a> of file <a class="el" href="validation_8h_source.html">validation.h</a>.</p>

</div>
</div>
<a id="a225bfa76e7e892fa9b215b724aea6227" name="a225bfa76e7e892fa9b215b724aea6227"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a225bfa76e7e892fa9b215b724aea6227">&#9670;&nbsp;</a></span>m_failed_blocks</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::set&lt;<a class="el" href="class_c_block_index.html">CBlockIndex</a>*&gt; BlockManager::m_failed_blocks</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>In order to efficiently track invalidity of headers, we keep the set of blocks which we tried to connect and found to be invalid here (ie which were set to BLOCK_FAILED_VALID since the last restart). </p>
<p >We can then walk this set and check if a new header is a descendant of something in this set, preventing us from having to walk m_block_index when we try to connect a bad block and fail.</p>
<p >While this is more complicated than marking everything which descends from an invalid block as invalid at the time we discover it to be invalid, doing so would require walking all of m_block_index to find all descendants. Since this case should be very rare, keeping track of all BLOCK_FAILED_VALID blocks in a set should be just fine and work just as well.</p>
<p >Because we already walk m_block_index in height-order at startup, we go ahead and mark descendants of invalid blocks as FAILED_CHILD at that time, instead of putting things in this set. </p>

<p class="definition">Definition at line <a class="el" href="validation_8h_source.html#l00420">420</a> of file <a class="el" href="validation_8h_source.html">validation.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>src/<a class="el" href="validation_8h_source.html">validation.h</a></li>
<li>src/<a class="el" href="validation_8cpp_source.html">validation.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Nov 8 2021 14:20:10 for Bitcoin Core by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2
</small></address>
</body>
</html>
